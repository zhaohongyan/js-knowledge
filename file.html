<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <input type="file" onchange="previewFile()"><br>
  <img src="" height="200" alt="Image preview...">

  <button onclick="download()">下载</button>

  <script>

    var dataImage;
    var fileName;
    function previewFile() {
      var preview = document.querySelector('img');
      var file = document.querySelector('input[type=file]').files[0];
      console.log('file', file)
      console.log('file', file.name)
      fileName = file.name;
      var reader = new FileReader();

      reader.addEventListener("load", function () {
        dataImage = reader.result;
        preview.src = reader.result;
      }, false);

      if (file) {
        reader.readAsDataURL(file);
      }
    }

    // 源文件dataurl 转 blob
    function dataURLtoBlob(dataurl) {
      var arr = dataurl.split(','),
        mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]),
        n = bstr.length,
        u8arr = new Uint8Array(n)
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n)
      }
      return new Blob([u8arr], {
        type: mime
      })
    }

    function download() {
      var blob = dataURLtoBlob(dataImage)
      console.log('blob', blob)
      let link = document.createElement('a')
      link.href = window.URL.createObjectURL(blob)
      link.download = fileName;
      link.click()
      window.URL.revokeObjectURL(link.href)
    }
  </script>

</body>

</html>